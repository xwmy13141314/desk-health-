# DeskHealth æŠ€æœ¯è®¾è®¡æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0
> æ—¥æœŸï¼š2025-01-19
> è®¾è®¡å¸ˆï¼šGLM 4.7

---

## 1. æŠ€æœ¯é€‰å‹

### 1.1 æœ€ç»ˆæ–¹æ¡ˆï¼šC# (.NET 8 WPF)

| å¯¹æ¯”é¡¹ | C# (.NET 8 WPF) | Python + Tkinter |
|--------|-----------------|------------------|
| exeä½“ç§¯ | < 5MB | > 50MB |
| å†…å­˜å ç”¨ | < 20MB | 50-100MB |
| å¯åŠ¨é€Ÿåº¦ | < 1ç§’ | 2-3ç§’ |
| Windowsä½“éªŒ | åŸç”Ÿ | ä¸€èˆ¬ |
| å¼€å‘æ•ˆç‡ | ä¸­ | é«˜ |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­ |

**é€‰æ‹©ç†ç”±ï¼š**
- å®Œç¾ç¬¦åˆPRDæ€§èƒ½æŒ‡æ ‡ï¼ˆCPUâ‰¤5%, å†…å­˜â‰¤50MBï¼‰
- åŸç”ŸWindowsä½“éªŒï¼Œç³»ç»Ÿé›†æˆæ›´å¥½
- æ‰“åŒ…ä½“ç§¯æå°ï¼Œä¾¿äºåˆ†å‘

### 1.2 æ ¸å¿ƒä¾èµ–

```xml
<PackageReference Include="Hardcodet.Wpf.TaskbarNotification" Version="1.0.5" />
<PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DeskHealth æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Presentation Layer                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚  MainWindow  â”‚  â”‚ NotifyWindow â”‚  â”‚ TrayIconView â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  (éšè—ä¸»çª—å£) â”‚  â”‚ (åŠé€æ˜æç¤º) â”‚  â”‚  (æ‰˜ç›˜èœå•)   â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†•                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Application Layer                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚TimerService  â”‚  â”‚NotifyService â”‚  â”‚ConfigService â”‚     â”‚ â”‚
â”‚  â”‚  â”‚(è®¡æ—¶å™¨ç®¡ç†)  â”‚  â”‚(æé†’æ˜¾ç¤º)    â”‚  â”‚(é…ç½®ç®¡ç†)    â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†•                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Domain Layer                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚  Reminder    â”‚  â”‚  TimerState  â”‚  â”‚  AppConfig  â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  (æé†’å®ä½“)  â”‚  â”‚  (è®¡æ—¶çŠ¶æ€)  â”‚  â”‚  (é…ç½®å®ä½“)  â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é¡¹ç›®ç»“æ„

```
DeskHealth/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ DeskHealth.Core/              # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ Reminder.cs           # æé†’å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ TimerState.cs         # è®¡æ—¶çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ AppConfig.cs          # é…ç½®å®ä½“
â”‚   â”‚   â””â”€â”€ Interfaces/
â”‚   â”‚       â”œâ”€â”€ ITimerService.cs
â”‚   â”‚       â”œâ”€â”€ INotifyService.cs
â”‚   â”‚       â””â”€â”€ IConfigService.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ DeskHealth.Services/          # åº”ç”¨æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ TimerService.cs           # è®¡æ—¶å™¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ NotifyService.cs          # æé†’æœåŠ¡
â”‚   â”‚   â””â”€â”€ ConfigService.cs          # é…ç½®æœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ DeskHealth.App/               # è¡¨ç¤ºå±‚ï¼ˆWPFï¼‰
â”‚       â”œâ”€â”€ Views/
â”‚       â”‚   â”œâ”€â”€ MainWindow.xaml       # ä¸»çª—å£ï¼ˆéšè—ï¼‰
â”‚       â”‚   â”œâ”€â”€ NotifyWindow.xaml     # åŠé€æ˜æé†’çª—
â”‚       â”‚   â””â”€â”€ AboutWindow.xaml      # å…³äºå¯¹è¯æ¡†
â”‚       â”œâ”€â”€ ViewModels/
â”‚       â”‚   â””â”€â”€ NotifyViewModel.cs    # æé†’çª—ViewModel
â”‚       â”œâ”€â”€ Services/
â”‚       â”‚   â””â”€â”€ TrayIconService.cs    # æ‰˜ç›˜æœåŠ¡
â”‚       â”œâ”€â”€ App.xaml
â”‚       â””â”€â”€ App.xaml.cs
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ æŠ€æœ¯è®¾è®¡æ–‡æ¡£.md
â”‚   â””â”€â”€ APIæ–‡æ¡£.md
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ DeskHealth.Tests/
â”‚
â”œâ”€â”€ DeskHealth.sln
â””â”€â”€ README.md
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 TimerServiceï¼ˆè®¡æ—¶å™¨æœåŠ¡ï¼‰

**èŒè´£ï¼š**
- ç®¡ç†å¤šä¸ªæé†’è®¡æ—¶å™¨ï¼ˆå–æ°´ã€ä¼‘æ¯ï¼‰
- å¤„ç†æš‚åœ/æ¢å¤é€»è¾‘
- è§¦å‘æé†’äº‹ä»¶

**çŠ¶æ€æœºï¼š**

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     RUNNING      â”‚ â—„â”€â”€ å¯åŠ¨é»˜è®¤çŠ¶æ€
                    â”‚   (æ­£å¸¸è¿è¡Œ)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
         æš‚åœ1å°æ—¶       æš‚åœ2å°æ—¶          â”‚
              â”‚              â”‚              â”‚
              â–¼              â–¼              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
       â”‚ PAUSED_1H  â”‚  â”‚ PAUSED_2H  â”‚      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
              â”‚              â”‚              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                        æ¢å¤/è¶…æ—¶ç»“æŸ
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     RUNNING      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¥å£å®šä¹‰ï¼š**

```csharp
public interface ITimerService
{
    event EventHandler<ReminderEventArgs> ReminderTriggered;
    TimerState State { get; }
    void Start();
    void Pause(TimeSpan duration);
    void Resume();
    void Stop();
}

public class TimerService : ITimerService, IDisposable
{
    private readonly Dictionary<ReminderType, Timer> _timers;
    private readonly IConfigService _configService;
    private TimerState _state;
    private CancellationTokenSource _pauseCts;

    public event EventHandler<ReminderEventArgs> ReminderTriggered;

    public TimerState State => _state;

    public void Start()
    {
        _state = TimerState.Running;
        InitializeTimers();
    }

    public void Pause(TimeSpan duration)
    {
        _state = duration.TotalHours >= 2
            ? TimerState.Paused2H
            : TimerState.Paused1H;

        _pauseCts?.Cancel();
        _pauseCts = new CancellationTokenSource();

        Task.Delay(duration, _pauseCts.Token)
            .ContinueWith(_ => Resume());
    }

    public void Resume()
    {
        _state = TimerState.Running;
        _pauseCts?.Cancel();
    }

    private void InitializeTimers()
    {
        // å–æ°´æé†’ï¼š30åˆ†é’Ÿ
        _timers[ReminderType.Hydration] = new Timer(
            _ => OnReminderTriggered(ReminderType.Hydration),
            null,
            TimeSpan.FromMinutes(30),
            TimeSpan.FromMinutes(30));

        // ä¼‘æ¯æé†’ï¼š60åˆ†é’Ÿ
        _timers[ReminderType.Break] = new Timer(
            _ => OnReminderTriggered(ReminderType.Break),
            null,
            TimeSpan.FromMinutes(60),
            TimeSpan.FromMinutes(60));
    }

    private void OnReminderTriggered(ReminderType type)
    {
        if (_state != TimerState.Running) return;

        var reminder = _configService.GetReminder(type);
        ReminderTriggered?.Invoke(this, new ReminderEventArgs(reminder));
    }

    public void Dispose()
    {
        foreach (var timer in _timers.Values)
        {
            timer.Dispose();
        }
        _pauseCts?.Cancel();
        _pauseCts?.Dispose();
    }
}
```

### 3.2 NotifyServiceï¼ˆæé†’æœåŠ¡ï¼‰

**èŒè´£ï¼š**
- æ˜¾ç¤º/éšè—åŠé€æ˜æé†’çª—å£
- ç®¡ç†è‡ªåŠ¨å…³é—­å€’è®¡æ—¶
- å¤„ç†ç”¨æˆ·æ‰‹åŠ¨å…³é—­

**æ¥å£å®šä¹‰ï¼š**

```csharp
public interface INotifyService
{
    void ShowReminder(Reminder reminder);
    void HideReminder();
}

public class NotifyService : INotifyService
{
    private readonly NotifyWindow _window;
    private Timer _autoCloseTimer;

    public NotifyService()
    {
        _window = new NotifyWindow();
        _window.Closed += OnWindowClosed;
    }

    public void ShowReminder(Reminder reminder)
    {
        _window.DataContext = reminder;

        // è®¡ç®—å±å¹•å³ä¸‹è§’ä½ç½®
        var screenWidth = SystemParameters.PrimaryScreenWidth;
        var screenHeight = SystemParameters.PrimaryScreenHeight;
        var taskbarHeight = GetTaskbarHeight();

        _window.Left = screenWidth - _window.Width - 10;
        _window.Top = screenHeight - taskbarHeight - _window.Height - 10;

        // å…³é”®ï¼šä¸æ¿€æ´»çª—å£ï¼Œä¸æŠ¢ç„¦ç‚¹
        _window.ShowActivated = false;
        _window.Show();

        // 10ç§’åè‡ªåŠ¨å…³é—­
        _autoCloseTimer?.Dispose();
        _autoCloseTimer = new Timer(
            _ => HideReminder(),
            null,
            TimeSpan.FromSeconds(10),
            Timeout.InfiniteTimeSpan);
    }

    public void HideReminder()
    {
        _window.Dispatcher.Invoke(() =>
        {
            _window.Hide();
            _autoCloseTimer?.Dispose();
        });
    }

    private double GetTaskbarHeight()
    {
        // æ£€æµ‹ä»»åŠ¡æ ä½ç½®å¹¶è¿”å›ç›¸åº”é«˜åº¦/å®½åº¦
        var workingArea = SystemParameters.WorkArea;
        if (workingArea.Bottom < SystemParameters.PrimaryScreenHeight)
            return SystemParameters.PrimaryScreenHeight - workingArea.Bottom;
        return 40; // é»˜è®¤å€¼
    }
}
```

### 3.3 ConfigServiceï¼ˆé…ç½®æœåŠ¡ï¼‰

**èŒè´£ï¼š**
- ç®¡ç†åº”ç”¨é…ç½®
- æŒä¹…åŒ–åˆ°JSONæ–‡ä»¶
- æä¾›é»˜è®¤é…ç½®

**é…ç½®æ–‡ä»¶è·¯å¾„ï¼š** `%AppData%/DeskHealth/config.json`

```csharp
public interface IConfigService
{
    AppConfig LoadConfig();
    void SaveConfig(AppConfig config);
    Reminder GetReminder(ReminderType type);
}

public class ConfigService : IConfigService
{
    private readonly string _configPath;
    private AppConfig _cachedConfig;

    public ConfigService()
    {
        var appDataPath = Environment.GetFolderPath(
            Environment.SpecialFolder.ApplicationData);
        var appFolder = Path.Combine(appDataPath, "DeskHealth");

        Directory.CreateDirectory(appFolder);
        _configPath = Path.Combine(appFolder, "config.json");
    }

    public AppConfig LoadConfig()
    {
        if (_cachedConfig != null)
            return _cachedConfig;

        if (!File.Exists(_configPath))
        {
            _cachedConfig = GetDefaultConfig();
            SaveConfig(_cachedConfig);
            return _cachedConfig;
        }

        var json = File.ReadAllText(_configPath);
        _cachedConfig = JsonSerializer.Deserialize<AppConfig>(json);
        return _cachedConfig;
    }

    public void SaveConfig(AppConfig config)
    {
        var json = JsonSerializer.Serialize(config, new JsonSerializerOptions
        {
            WriteIndented = true
        });
        File.WriteAllText(_configPath, json);
        _cachedConfig = config;
    }

    public Reminder GetReminder(ReminderType type)
    {
        var config = LoadConfig();
        return config.Reminders.FirstOrDefault(r => r.Type == type)
            ?? throw new ArgumentException($"No reminder found for type: {type}");
    }

    private static AppConfig GetDefaultConfig()
    {
        return new AppConfig
        {
            Version = "1.0.0",
            AutoStart = true,
            EnableSound = false, // MVPé»˜è®¤é™éŸ³
            Reminders = new List<Reminder>
            {
                new Reminder
                {
                    Type = ReminderType.Hydration,
                    Title = "è¯¥å–æ°´äº† ğŸ¥¤",
                    Message = "ä¿æŒå¥åº·ï¼Œå¤šå–æ°´ï¼",
                    IntervalMinutes = 30,
                    AutoCloseSeconds = 10
                },
                new Reminder
                {
                    Type = ReminderType.Break,
                    Title = "ä¼‘æ¯ä¸€ä¸‹ ğŸŒ¿",
                    Message = "ç«™èµ·æ¥æ´»åŠ¨æ´»åŠ¨ï¼Œä¿æŠ¤é¢ˆæ¤ï¼",
                    IntervalMinutes = 60,
                    AutoCloseSeconds = 10
                }
            }
        };
    }
}
```

---

## 4. UI/UX è®¾è®¡

### 4.1 æé†’çª—å£

**è§†è§‰æ•ˆæœï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯¥å–æ°´äº† ğŸ¥¤                           [Ã—] â”‚  â† 200px Ã— 80px
â”‚                                         â”‚
â”‚  ä¿æŒå¥åº·ï¼Œå¤šå–æ°´ï¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†‘ å³ä¸‹è§’ä½ç½®ï¼ˆè´´åˆä»»åŠ¡æ ä¸Šæ–¹ï¼‰
```

**XAML å®ç°ï¼š**

```xml
<!-- NotifyWindow.xaml -->
<Window x:Class="DeskHealth.App.Views.NotifyWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Width="200" Height="80"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowActivated="False"
        ShowInTaskbar="False"
        ResizeMode="NoResize">

    <Border Background="#E6E6E6"
            Opacity="0.7"
            CornerRadius="8"
            BorderBrush="#CCCCCC"
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- å…³é—­æŒ‰é’® -->
            <Button Grid.Row="0"
                    Content="Ã—"
                    Width="24"
                    Height="24"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,4,8,0"
                    Background="Transparent"
                    BorderThickness="0"
                    FontSize="16"
                    Foreground="#666666"
                    Cursor="Hand"
                    Click="OnCloseClicked">
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#FF0000"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- æé†’å†…å®¹ -->
            <StackPanel Grid.Row="1"
                        VerticalAlignment="Center"
                        Margin="20,8">
                <TextBlock Text="{Binding Title}"
                          FontSize="14"
                          FontWeight="SemiBold"
                          Foreground="#333333"/>
                <TextBlock Text="{Binding Message}"
                          FontSize="11"
                          Foreground="#555555"
                          Margin="0,4,0,0"
                          TextWrapping="Wrap"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
```

**å…³é”®å±æ€§è¯´æ˜ï¼š**

| å±æ€§ | å€¼ | ä½œç”¨ |
|------|-----|------|
| `WindowStyle` | None | æ— è¾¹æ¡† |
| `AllowsTransparency` | True | å…è®¸é€æ˜ |
| `Background` | Transparent | çª—å£èƒŒæ™¯é€æ˜ |
| `ShowActivated` | False | ä¸æ¿€æ´»çª—å£ï¼ˆä¸æŠ¢ç„¦ç‚¹ï¼‰ |
| `Topmost` | True | ç½®é¡¶æ˜¾ç¤º |
| `ShowInTaskbar` | False | ä¸æ˜¾ç¤ºåœ¨ä»»åŠ¡æ  |

### 4.2 ç³»ç»Ÿæ‰˜ç›˜

**èœå•ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’§ DeskHealth v1.0.0   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…³äº DeskHealth...      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æš‚åœæé†’ 1 å°æ—¶         â”‚
â”‚ æš‚åœæé†’ 2 å°æ—¶         â”‚
â”‚ æ¢å¤æé†’                â”‚ â† ä»…æš‚åœæ—¶æ˜¾ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€€å‡º                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç ï¼š**

```csharp
public class TrayIconService
{
    private readonly NotifyIcon _notifyIcon;
    private readonly ITimerService _timerService;

    public TrayIconService(ITimerService timerService)
    {
        _timerService = timerService;
        _notifyIcon = new NotifyIcon
        {
            Icon = Properties.Resources.AppIcon,
            Text = "DeskHealth - æ¡Œé¢å¥åº·æé†’",
            Visible = true
        };

        SetupContextMenu();
    }

    private void SetupContextMenu()
    {
        var menu = new ContextMenuStrip();

        // ç‰ˆæœ¬ä¿¡æ¯ï¼ˆä¸å¯ç‚¹å‡»ï¼‰
        var titleItem = new ToolStripLabel($"DeskHealth v{GetVersion()}")
        {
            Font = new Font("Segoe UI", 9, FontStyle.Bold)
        };
        menu.Items.Add(new ToolStripControlHost(titleItem));
        menu.Items.Add(new ToolStripSeparator());

        // å…³äº
        menu.Items.Add("å…³äº DeskHealth...", null, OnAboutClicked);

        // æš‚åœ/æ¢å¤
        menu.Items.Add(new ToolStripSeparator());
        menu.Items.Add("æš‚åœæé†’ 1 å°æ—¶", null, _ => Pause(1));
        menu.Items.Add("æš‚åœæé†’ 2 å°æ—¶", null, _ => Pause(2));

        var resumeItem = new ToolStripMenuItem("æ¢å¤æé†’", null, _ => Resume());
        resumeItem.Name = "ResumeItem";
        menu.Items.Add(resumeItem);

        // é€€å‡º
        menu.Items.Add(new ToolStripSeparator());
        menu.Items.Add("é€€å‡º", null, OnExitClicked);

        _notifyIcon.ContextMenuStrip = menu;
        UpdateMenuState();
    }

    private void Pause(int hours)
    {
        _timerService.Pause(TimeSpan.FromHours(hours));
        UpdateMenuState();
    }

    private void Resume()
    {
        _timerService.Resume();
        UpdateMenuState();
    }

    private void UpdateMenuState()
    {
        var menu = _notifyIcon.ContextMenuStrip;
        var resumeItem = menu.Items.Find("ResumeItem", false).FirstOrDefault() as ToolStripMenuItem;

        if (_timerService.State == TimerState.Running)
        {
            resumeItem.Visible = false;
        }
        else
        {
            resumeItem.Visible = true;
            resumeItem.Text = _timerService.State == TimerState.Paused1H
                ? "æ¢å¤æé†’ (å‰©ä½™ XX åˆ†é’Ÿ)"
                : "æ¢å¤æé†’ (å‰©ä½™ XX åˆ†é’Ÿ)";
        }
    }

    public void Dispose()
    {
        _notifyIcon?.Dispose();
    }
}
```

---

## 5. é¢†åŸŸæ¨¡å‹

### 5.1 å®ä½“å®šä¹‰

```csharp
// æé†’ç±»å‹
public enum ReminderType
{
    Hydration,  // å–æ°´
    Break       // ä¼‘æ¯
}

// è®¡æ—¶çŠ¶æ€
public enum TimerState
{
    Running,
    Paused1H,
    Paused2H
}

// æé†’å®ä½“
public class Reminder
{
    public ReminderType Type { get; set; }
    public string Title { get; set; }
    public string Message { get; set; }
    public int IntervalMinutes { get; set; }
    public int AutoCloseSeconds { get; set; }
}

// åº”ç”¨é…ç½®
public class AppConfig
{
    public string Version { get; set; }
    public bool AutoStart { get; set; }
    public bool EnableSound { get; set; }
    public List<Reminder> Reminders { get; set; }
}
```

---

## 6. å¼€æœºè‡ªå¯åŠ¨

### 6.1 å®ç°æ–¹å¼

é€šè¿‡æ³¨å†Œè¡¨ `Run` é”®å€¼å®ç°ï¼š

```csharp
public static class AutoStartHelper
{
    private const string RunKeyPath = @"Software\Microsoft\Windows\CurrentVersion\Run";
    private const string AppName = "DeskHealth";

    public static void SetAutoStart(bool enable)
    {
        using var key = Registry.CurrentUser.OpenSubKey(RunKeyPath, true);
        var exePath = Process.GetCurrentProcess().MainModule?.FileName;

        if (enable)
        {
            key?.SetValue(AppName, $"\"{exePath}\"");
        }
        else
        {
            key?.DeleteValue(AppName, false);
        }
    }

    public static bool IsAutoStartEnabled()
    {
        using var key = Registry.CurrentUser.OpenSubKey(RunKeyPath, false);
        var value = key?.GetValue(AppName);
        return value != null;
    }
}
```

---

## 7. å•ä¾‹è¿è¡Œ

### 7.1 Mutex å®ç°

```csharp
public partial class App : Application
{
    private const string MutexName = "Global\\DeskHealth_SingleInstanceMutex";
    private Mutex _mutex;

    protected override void OnStartup(StartupEventArgs e)
    {
        // æ£€æŸ¥æ˜¯å¦å·²æœ‰å®ä¾‹è¿è¡Œ
        _mutex = new Mutex(true, MutexName, out bool createdNew);

        if (!createdNew)
        {
            MessageBox.Show(
                "DeskHealth å·²ç»åœ¨è¿è¡Œä¸­ã€‚",
                "æç¤º",
                MessageBoxButton.OK,
                MessageBoxImage.Information);
            Shutdown();
            return;
        }

        base.OnStartup(e);
    }

    protected override void OnExit(ExitEventArgs e)
    {
        _mutex?.ReleaseMutex();
        _mutex?.Dispose();
        base.OnExit(e);
    }
}
```

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 èµ„æºæ§åˆ¶ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®ç°æ–¹å¼ |
|------|--------|----------|
| CPUå ç”¨ | â‰¤ 5% | ä½¿ç”¨ `Timer` è€Œé `DispatcherTimer` |
| å†…å­˜å ç”¨ | â‰¤ 50MB | å»¶è¿ŸåŠ è½½ã€åŠæ—¶é‡Šæ”¾èµ„æº |
| å¯åŠ¨æ—¶é—´ | â‰¤ 1ç§’ | å¼‚æ­¥åˆå§‹åŒ–ã€å»¶è¿ŸåŠ è½½éæ ¸å¿ƒèµ„æº |
| è¿è¡Œç¨³å®šæ€§ | 72h+ æ— å´©æºƒ | å¼‚å¸¸å¤„ç† + æ—¥å¿—è®°å½• |

### 8.2 ä¼˜åŒ–æªæ–½

```csharp
// 1. ä½¿ç”¨ Timer è€Œé DispatcherTimer
// Timer ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä¸å ç”¨ UI çº¿ç¨‹
private Timer _timer;
_timer = new Timer(callback, null, dueTime, period);

// 2. åŠæ—¶é‡Šæ”¾å®šæ—¶å™¨
public void Dispose()
{
    _autoCloseTimer?.Dispose();
    _pauseCts?.Cancel();
    _pauseCts?.Dispose();
}

// 3. å»¶è¿ŸåŠ è½½éæ ¸å¿ƒèµ„æº
private void LoadNonCriticalResourcesAsync()
{
    Task.Run(() =>
    {
        // åå°åŠ è½½å›¾æ ‡ã€èµ„æºç­‰
    });
}
```

---

## 9. æ‰“åŒ…ä¸åˆ†å‘

### 9.1 å‘å¸ƒé…ç½®

```xml
<!-- é¡¹ç›®æ–‡ä»¶é…ç½® -->
<PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <PublishSingleFile>true</PublishSingleFile>
    <SelfContained>true</SelfContained>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <PublishTrimmed>true</PublishTrimmed>
    <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
</PropertyGroup>
```

### 9.2 å‘å¸ƒå‘½ä»¤

```bash
# å‘å¸ƒä¸ºå•ä¸ª exe
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true

# è¾“å‡ºå¤§å°é¢„è®¡ï¼š< 10MB
```

### 9.3 åˆ†å‘æ–¹å¼

- **ç»¿è‰²ç‰ˆ**ï¼šå•æ–‡ä»¶ exeï¼Œç›´æ¥è¿è¡Œ
- **å®‰è£…ç‰ˆ**ï¼šä½¿ç”¨ WiX Toolset åˆ›å»º MSI å®‰è£…åŒ…

---

## 10. æµ‹è¯•è®¡åˆ’

### 10.1 åŠŸèƒ½æµ‹è¯•

| æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|----------|
| å¯åŠ¨åº”ç”¨ | æ‰˜ç›˜å›¾æ ‡æ˜¾ç¤ºï¼Œè®¡æ—¶å™¨å¼€å§‹ |
| 30åˆ†é’Ÿå | æ˜¾ç¤ºå–æ°´æé†’ï¼Œ10ç§’åè‡ªåŠ¨æ¶ˆå¤± |
| ç‚¹å‡»å…³é—­æŒ‰é’® | æé†’ç«‹å³æ¶ˆå¤± |
| æš‚åœ1å°æ—¶ | è®¡æ—¶å™¨æš‚åœï¼Œ1å°æ—¶åæ¢å¤ |
| æ¢å¤æé†’ | è®¡æ—¶å™¨ç»§ç»­è¿è¡Œ |
| é€€å‡ºåº”ç”¨ | æ‰˜ç›˜å›¾æ ‡æ¶ˆå¤±ï¼Œç¨‹åºå…³é—­ |

### 10.2 æ€§èƒ½æµ‹è¯•

- ä½¿ç”¨ `PerformanceMonitor` ç›‘æ§ CPU/å†…å­˜
- è¿ç»­è¿è¡Œ 72 å°æ—¶ç¨³å®šæ€§æµ‹è¯•
- é«˜ DPI (200%, 300%) æ˜¾ç¤ºæµ‹è¯•

---

## 11. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **æŠ€æœ¯é€‰å‹ç¡®è®¤** âœ… (å·²å®Œæˆï¼Œé‡‡ç”¨ C# .NET 8 WPF)
2. **é¡¹ç›®åˆå§‹åŒ–** (åˆ›å»ºè§£å†³æ–¹æ¡ˆã€é…ç½®ä¾èµ–)
3. **æ ¸å¿ƒåŠŸèƒ½å¼€å‘**
   - [ ] TimerService å®ç°
   - [ ] NotifyWindow UI å®ç°
   - [ ] TrayIconService å®ç°
   - [ ] ConfigService å®ç°
4. **é›†æˆæµ‹è¯•**
5. **å°èŒƒå›´ç°åº¦æµ‹è¯•** (2-3ååŒäº‹è¯•ç”¨1å¤©)
6. **æ­£å¼å‘å¸ƒ**

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- [WPF å®˜æ–¹æ–‡æ¡£](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/)
- [Hardcodet.NotifyIcon](https://github.com/hardcodet/wpf-notifyicon)
- [.NET 8 å‘å¸ƒå•æ–‡ä»¶åº”ç”¨](https://docs.microsoft.com/en-us/dotnet/core/deploying/single-file/)

### B. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| v1.0 | 2025-01-19 | åˆå§‹è®¾è®¡æ–‡æ¡£ |
